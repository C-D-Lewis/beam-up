<!DOCTYPE html>
<html>
  <head>
    <title>Beam Up Configuration</title>
  </head>
  <body>
    <h2>Beam Up Configuration</h2>
    <p>Choose settings, click 'Save' and reload app.</p>
 
    <table>
      <tr>
        <td>Inverted colours</td><td><input id="check_inverted" type="checkbox"/></td>
      </tr>
      <tr>
        <td>Show short date</td><td><input id="check_date" type="checkbox"/></td>
      </tr>
      <tr>
        <td>Animations</td><td><input id="check_animations" type="checkbox"/></td>
      </tr>
      <tr>
        <td>Show disconnected indicator</td><td><input id="check_bluetooth" type="checkbox"/></td>
      </tr>
      <tr>
        <td>Shake to show battery level</td><td><input id="check_battery" type="checkbox"/></td>
      </tr>
      <tr>
        <td>Vibrate on the hour</td><td><input id="check_hourly" type="checkbox"/></td>
      </tr>
      <tr>
        <td>Vibration type on the hour</td><td id="hourly_vibe"><input name="hourly_vibe" type="radio" value="0"/> Beam Up<br/><input name="hourly_vibe" type="radio" value="1"/> Single<br/><input name="hourly_vibe" type="radio" value="2"/> Double<br/><input name="hourly_vibe" type="radio" value="3"/> Long<br/></td>
      </tr>
      <tr>
        <td>Vibration type on disconnect</td><td id="bluetooth_vibe"><input name="bluetooth_vibe" type="radio" value="1"/> Single<br/><input name="bluetooth_vibe" type="radio" value="2"/> Double<br/><input name="bluetooth_vibe" type="radio" value="3"/> Long<br/></td>
      </tr>
    </table>

    <p>
    <button id="save_button">Save</button>
    </p>

    <hr />
    <h2>Version</h2>
    <p id="current_version">Current version:</p>
    <p id="p_version">Getting latest version...</p>

    <hr />

    <p>
    <h2>Latest News</h2>
    <p id="news">Loading...</p>
    </p>

    <script>
      function init() {
        document.getElementById("check_animations").checked = true;
        document.querySelector("#hourly_vibe input").checked = true;
        document.querySelector("#bluetooth_vibe input").checked = true;
      };

      function xhrAsyncRequest(url, type, callback) {
        var xhr = new XMLHttpRequest();
        xhr.onload = function () {
          callback(this.responseText);
        };
        xhr.open(type, url);
        xhr.send();
      };

      function getAppVersionAndNews() {
        //Get latest
        xhrAsyncRequest(
          "https://dl.dropboxusercontent.com/u/10824180/pebble%20config%20pages/app_versions.json", 
          "GET",
          function(responseText) {
            var json = JSON.parse(responseText);
            document.getElementById("p_version").innerHTML = "Latest version: " + json.beamup;
            document.getElementById("news").innerHTML = "" + json.beamupnews;
          }
        );

        //Get local
        var version = "" + document.location;
        version = version.substring(version.indexOf("version=") + "version=".length);
        document.getElementById("current_version").innerHTML = "Current version: " + version;
      }

      var submitButton = document.getElementById("save_button");
      submitButton.addEventListener("click", 
        function() {
          var options = {
            "inverted": document.getElementById("check_inverted").checked ? 'true' : 'false',
            "date": document.getElementById("check_date").checked ? 'true' : 'false',
            "animations": document.getElementById("check_animations").checked ? 'true' : 'false',
            "bluetooth": document.getElementById("check_bluetooth").checked ? 'true' : 'false',
            "battery": document.getElementById("check_battery").checked ? 'true' : 'false',
            "hourly": document.getElementById("check_hourly").checked ? 'true' : 'false',
            "hourly_vibe": +document.querySelector("#hourly_vibe input:checked").value,
            "bluetooth_vibe": +document.querySelector("#bluetooth_vibe input:checked").value
          };  
          
          var location = "pebblejs://close#" + encodeURIComponent(JSON.stringify(options));
          document.location = location;
        }, 
      false);

      init();
      getAppVersionAndNews();
    </script>
  </body>
</html>